<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Canvas Overlay Test - Stub Video</title>
    <style>
        ::-webkit-scrollbar {
            display: none;
        }
        
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #1a1a1a;
        }
        
        /* Same as mocap.html */
        .preview {
            position: fixed;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        
        .preview .input_video {
            width: 100%;
            max-width: 100%;
            max-height: 100%;
            height: auto;
            object-fit: contain;
            border: solid 1px #ccc;
            border-radius: 10px;
            overflow: hidden;
            transform: scale(-1, 1);
            display: block;
            background: #000;
        }
        
        .preview .guides {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            border: solid 1px #00ff00;
            border-radius: 10px;
            overflow: hidden;
            z-index: 1000;
            pointer-events: none;
            transform: scale(-1, 1);
            object-fit: contain;
        }
        
        .info-overlay {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            z-index: 2000;
            max-width: 250px;
        }
        
        .info-overlay h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: #00ff00;
        }
        
        .info-overlay .stat {
            margin: 5px 0;
        }
        
        .info-overlay .label {
            color: #888;
        }
        
        .orientation-toggle {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2000;
        }
        
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            margin: 0 5px;
        }
        
        .btn:hover {
            background: #5568d3;
        }
    </style>
</head>
<body>
    <div class="preview">
        <video class="input_video" autoplay muted playsinline></video>
        <canvas class="guides"></canvas>
    </div>
    
    <div class="info-overlay">
        <h3>üìä Test Info</h3>
        <div class="stat">
            <span class="label">Video Size:</span><br>
            <span id="videoSize">-</span>
        </div>
        <div class="stat">
            <span class="label">Canvas Size:</span><br>
            <span id="canvasSize">-</span>
        </div>
        <div class="stat">
            <span class="label">Orientation:</span><br>
            <span id="orientation">-</span>
        </div>
        <div class="stat">
            <span class="label">Aspect Ratio:</span><br>
            <span id="aspectRatio">-</span>
        </div>
    </div>
    
    <div class="orientation-toggle">
        <button class="btn" onclick="setOrientation('portrait')">üì± Portrait</button>
        <button class="btn" onclick="setOrientation('landscape')">üñ•Ô∏è Landscape</button>
    </div>
    
    <script>
        const videoElement = document.querySelector('.input_video');
        const guideCanvas = document.querySelector('.guides');
        let currentOrientation = 'portrait';
        
        // Create a canvas for generating stub video frames
        const sourceCanvas = document.createElement('canvas');
        const sourceCtx = sourceCanvas.getContext('2d');
        
        function setOrientation(orientation) {
            currentOrientation = orientation;
            
            if (orientation === 'portrait') {
                sourceCanvas.width = 720;
                sourceCanvas.height = 1280;
            } else {
                sourceCanvas.width = 1280;
                sourceCanvas.height = 720;
            }
            
            startStubVideo();
        }
        
        function startStubVideo() {
            // Create MediaStream from canvas
            const stream = sourceCanvas.captureStream(30);
            videoElement.srcObject = stream;
            videoElement.play();
            
            // Start drawing frames
            drawStubFrames();
        }
        
        let frameCount = 0;
        function drawStubFrames() {
            frameCount++;
            
            // Draw gradient background
            const gradient = sourceCtx.createLinearGradient(0, 0, sourceCanvas.width, sourceCanvas.height);
            gradient.addColorStop(0, '#667eea');
            gradient.addColorStop(1, '#764ba2');
            sourceCtx.fillStyle = gradient;
            sourceCtx.fillRect(0, 0, sourceCanvas.width, sourceCanvas.height);
            
            // Draw frame info
            sourceCtx.fillStyle = 'white';
            sourceCtx.font = 'bold 48px Arial';
            sourceCtx.textAlign = 'center';
            sourceCtx.fillText('üìπ Stub Video Feed', sourceCanvas.width / 2, 100);
            
            sourceCtx.font = '32px Arial';
            sourceCtx.fillText(`${sourceCanvas.width} x ${sourceCanvas.height}`, sourceCanvas.width / 2, 160);
            sourceCtx.fillText(currentOrientation.toUpperCase(), sourceCanvas.width / 2, 210);
            
            // Draw animated circle (simulating movement)
            const centerX = sourceCanvas.width / 2 + Math.sin(frameCount * 0.05) * 100;
            const centerY = sourceCanvas.height / 2 + Math.cos(frameCount * 0.03) * 100;
            
            sourceCtx.fillStyle = 'rgba(255, 255, 255, 0.3)';
            sourceCtx.beginPath();
            sourceCtx.arc(centerX, centerY, 50, 0, Math.PI * 2);
            sourceCtx.fill();
            
            // Draw grid (simulating person tracking points)
            sourceCtx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            sourceCtx.lineWidth = 2;
            for (let i = 0; i < 5; i++) {
                const x = (sourceCanvas.width / 6) * (i + 1);
                sourceCtx.beginPath();
                sourceCtx.moveTo(x, 0);
                sourceCtx.lineTo(x, sourceCanvas.height);
                sourceCtx.stroke();
            }
            for (let i = 0; i < 5; i++) {
                const y = (sourceCanvas.height / 6) * (i + 1);
                sourceCtx.beginPath();
                sourceCtx.moveTo(0, y);
                sourceCtx.lineTo(sourceCanvas.width, y);
                sourceCtx.stroke();
            }
            
            requestAnimationFrame(drawStubFrames);
        }
        
        // Draw skeleton overlay on canvas (same pattern as mocap.js)
        function drawSkeletonOverlay() {
            // Get video's rendered dimensions
            const videoWidth = videoElement.offsetWidth || videoElement.clientWidth;
            const videoHeight = videoElement.offsetHeight || videoElement.clientHeight;
            
            // Update canvas internal dimensions to match video
            if (guideCanvas.width !== videoWidth || guideCanvas.height !== videoHeight) {
                guideCanvas.width = videoWidth;
                guideCanvas.height = videoHeight;
            }
            
            const ctx = guideCanvas.getContext('2d');
            ctx.clearRect(0, 0, guideCanvas.width, guideCanvas.height);
            
            // Draw skeleton overlay
            ctx.strokeStyle = '#00ff00';
            ctx.fillStyle = '#00ff00';
            ctx.lineWidth = 3;
            
            // Draw a simple skeleton figure
            const centerX = guideCanvas.width / 2;
            const centerY = guideCanvas.height / 2;
            
            // Head
            ctx.beginPath();
            ctx.arc(centerX, centerY - 100, 30, 0, Math.PI * 2);
            ctx.stroke();
            
            // Body
            ctx.beginPath();
            ctx.moveTo(centerX, centerY - 70);
            ctx.lineTo(centerX, centerY + 50);
            ctx.stroke();
            
            // Arms
            ctx.beginPath();
            ctx.moveTo(centerX, centerY - 50);
            ctx.lineTo(centerX - 60, centerY);
            ctx.moveTo(centerX, centerY - 50);
            ctx.lineTo(centerX + 60, centerY);
            ctx.stroke();
            
            // Legs
            ctx.beginPath();
            ctx.moveTo(centerX, centerY + 50);
            ctx.lineTo(centerX - 40, centerY + 120);
            ctx.moveTo(centerX, centerY + 50);
            ctx.lineTo(centerX + 40, centerY + 120);
            ctx.stroke();
            
            // Draw corner markers to show canvas bounds
            ctx.fillStyle = '#00ff00';
            ctx.fillRect(5, 5, 10, 10);
            ctx.fillRect(guideCanvas.width - 15, 5, 10, 10);
            ctx.fillRect(5, guideCanvas.height - 15, 10, 10);
            ctx.fillRect(guideCanvas.width - 15, guideCanvas.height - 15, 10, 10);
            
            // Draw info text
            ctx.font = '14px monospace';
            ctx.fillStyle = '#00ff00';
            ctx.fillText(`Canvas: ${guideCanvas.width}x${guideCanvas.height}`, 20, 30);
            
            requestAnimationFrame(drawSkeletonOverlay);
        }
        
        // Update info display
        function updateInfo() {
            document.getElementById('videoSize').textContent = 
                `${videoElement.offsetWidth}x${videoElement.offsetHeight} px`;
            
            document.getElementById('canvasSize').textContent = 
                `${guideCanvas.width}x${guideCanvas.height} px`;
            
            document.getElementById('orientation').textContent = currentOrientation;
            
            const aspectRatio = videoElement.offsetWidth && videoElement.offsetHeight
                ? (videoElement.offsetWidth / videoElement.offsetHeight).toFixed(2)
                : '-';
            document.getElementById('aspectRatio').textContent = aspectRatio;
            
            setTimeout(updateInfo, 100);
        }
        
        // Initialize with portrait
        setOrientation('portrait');
        
        // Start overlay drawing when video is ready
        videoElement.addEventListener('loadedmetadata', () => {
            console.log('Video ready:', videoElement.videoWidth, 'x', videoElement.videoHeight);
            drawSkeletonOverlay();
        });
        
        // Start info updates
        updateInfo();
    </script>
</body>
</html>
